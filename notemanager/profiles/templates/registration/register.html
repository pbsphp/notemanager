<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />

        {% load staticfiles %}
        <link rel="stylesheet" type="text/css" href="http://dev.sencha.com/deploy/ext-3.4.0/resources/css/ext-all.css" />

        <!-- Why wipe heroku? -->
        <script type="text/javascript" src="http://dev.sencha.com/deploy/ext-3.4.0/adapter/ext/ext-base.js"></script>
        <script type="text/javascript" src="http://dev.sencha.com/deploy/ext-3.4.0/ext-all.js"></script>

        <!-- Local scripts -->

        <script type="text/javascript" src="{% static "script/NoteForm.js" %}"></script>
        <script type="text/javascript" src="{% static "script/NoteFormWindow.js" %}"></script>

        <script type="text/javascript">

            Ext.onReady(function(){

                // Add csrf token to every ajax request
                // Snippet from stackoverflow
                var token = Ext.util.Cookies.get('csrftoken');
                if(!token){
                    Ext.Error.raise("Missing csrftoken cookie");
                } else {
                    Ext.Ajax.defaultHeaders = Ext.apply(Ext.Ajax.defaultHeaders || {}, {
                        'X-CSRFToken': token
                    });
                }

                // Signup form
                var signupForm = new Ext.form.FormPanel({
                    url: "{% url "register" %}",
                    method: "POST",
                    standardSubmit: true,
                    labelWidth: 75,
                    bodyStyle:'padding:5px 5px 0',


                    defaultType: 'textfield',
                    items: [
                        {
                            fieldLabel: "Username",
                            name: "username",
                            xtype: "textfield",
                        },
                        {
                            fieldLabel: "Password",
                            name: "password1",
                            inputType: "password",
                            xtype: "textfield"
                        },
                        {
                            fieldLabel: "Repeat",
                            name: "password2",
                            inputType: "password",
                            xtype: "textfield"
                        },
                        {
                            name: "csrfmiddlewaretoken",
                            xtype: "hidden",
                            value: "{{ csrf_token }}"
                        }
                    ],
                    buttons: [{
                        text: "submit",
                        handler: function() {
                            signupForm.getForm().submit();
                        }
                    }]
                });


                // Login form window
                var win = new Ext.Window({
                    layout: "fit",
                    width: 300,
                    height: 200,
                    closable: false,
                    plain: true,
                    items: signupForm,
                    title: "Login",
                });
                win.show(this);


                // Show errors if exists
                {% if form.errors %}
                    Ext.MessageBox.alert("Login failed",
                        "Username and password did not match, try again.");
                {% endif %}

            });

        </script>
    </head>
    <body>
    </body>
</html>
